{% load static %}
<!doctype html>
<html>
  <head>
    <title>AVCS - Automatic Variable Creation System</title>
    <link rel="icon" type="image/png" href="{% static 'img/favicon.png' %}" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>

      .cursor {
        cursor: pointer !important;
        background-color: rgb(59 101 165);
      }

      .column-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .column-item {
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 4px;
        margin-bottom: 2px;
        transition: background-color 0.2s;
      }

      .column-item:hover {
        background-color: #f8f9fa;
      }

      .selected-column {
        background-color: #e9ecef;
        font-weight: 500;
      }

      .feature-select {
        max-height: 150px;
        overflow-y: auto;
        border: 1px solid #ced4da;
        padding: 8px;
        border-radius: 4px;
      }

      .svg-container {
        position: relative;
        overflow: auto;
        max-height: 600px;
      }

      .svg-container svg {
        max-width: 100%;
        height: auto;
      }

      .zoom-controls {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 4px;
        padding: 4px;
      }

      .chat-container {
        height: 300px;
        overflow-y: auto;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
      }

      .chat-message {
        padding: 10px 10px;
        margin-bottom: 10px;
        border-radius: 5px;
        display: table;
        max-width: 720px !important;
      }

      .user-message {
        background-color: #f1f0f0;
        margin-left: auto;
      }

      .system-message {
        background-color: #e3f2fd;
        margin-right: 20%;
      }

      .hidden {
        display: none;
      }

      .loader {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 2s linear infinite;
        margin: 20px auto;
      }

      .tab-content {
        overflow: scroll !important;
        max-height: 720px;
      }

      #data-section {
        margin-bottom: 40px;
      }

      .overview-chat {
        height: 100%;
        padding: 4px 1px 1px 1px;
        overflow: scroll;
        font-size: 0.8em;
      }

      .overview-body {
        height: 10em;
        overflow-y: auto;
        padding-bottom: 2px !important;
        -webkit-mask-image: linear-gradient(180deg, #000 90%, transparent);
      }

      #overview-pane {
        flex: 1 2 auto;
      }

      .up-card {
        flex: 4 0 auto;
        height: 5%;
      }

      .col-left-child {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .col-double {
        display: flex;
        flex-direction: column;
      }

      table {
        border-style: hidden;
        margin-bottom: 2px;
      }

      th,
      td {
        text-align: center !important;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <!--<div class="row">-->

    <!-- Column Management Section -->
    <!--<div id="column-management" class="card mb-4">-->
    <!--    <div class="card-header">Column Management</div>-->
    <!--    <div class="card-body">-->
    <!--        <div class="mb-3">-->
    <!--            <label class="form-label">Dataset Columns</label>-->
    <!--            <div id="column-list" class="column-list list-group">-->
    <!--                <!-- Columns will be added here dynamically -->
    <!--            </div>-->
    <!--        </div>-->
    <!--        <button id="add-column-btn" class="btn btn-outline-primary btn-sm">Add New Column</button>-->
    <!--        <button id="edit-column-btn" class="btn btn-outline-secondary btn-sm" disabled>Edit Selected</button>-->
    <!--        <button id="delete-column-btn" class="btn btn-outline-danger btn-sm" disabled>Delete Selected</button>-->
    <!--    </div>-->
    <!--</div>-->

    <!-- Main Content Area -->
    <!--<div class="col-md-9">-->
    <!--    <div class="card mb-4">-->
    <!--        <div class="card-header">Interact with Your Data</div>-->
    <!--        <div class="card-body">-->
    <!--            <div id="chat-container" class="chat-container"></div>-->
    <!--            <div class="input-group">-->
    <!--                <input type="text" id="query-input" class="form-control" placeholder="Ask something about your data..." disabled>-->
    <!--                <button id="send-query" class="btn btn-primary" disabled>Send</button>-->
    <!--            </div>-->
    <!--            <div class="mt-2">-->
    <!--                <span class="badge bg-secondary me-1">describe</span>-->
    <!--                <span class="badge bg-secondary me-1">filter:column>value</span>-->
    <!--                <span class="badge bg-secondary me-1">groupby:column</span>-->
    <!--                <span class="badge bg-secondary me-1">sort:column,desc</span>-->
    <!--            </div>-->
    <!--        </div>-->
    <!--    </div>-->

    <div class="container mt-4">
      <div
        style="
          display: flex;
          align-items: center; /* justify-content: center; */
        "
      >
        <div>
          <img
            src="{% static 'img/logo.svg' %}"
            alt="AVCS"
            ,=""
            width="90"
            height="90"
          />
        </div>
        <div>
          <h1 style="font-weight: 600">AVCS</h1>
        </div>
      </div>

      <div class="row">
        <!-- Upload Section -->
        <!--<div class="col-md-4">-->
        <!--    <div class="card">-->
        <!--        <div class="card-header">Upload CSV File</div>-->
        <!--        <div class="card-body">-->
        <!--            <form id="upload-form" enctype="multipart/form-data">-->
        <!--                <div class="mb-3">-->
        <!--                    <input type="file" name="file" id="id_file" class="form-control" accept=".csv">-->
        <!--                    <div id="file-error" class="text-danger mt-1"></div>-->
        <!--                </div>-->
        <!--                <button type="submit" class="btn btn-primary">Upload</button>-->
        <!--            </form>-->
        <!--            <div id="upload-status" class="mt-3"></div>-->
        <!--            <div id="loader" class="loader hidden"></div>-->
        <!--        </div>-->
        <!--    </div>-->
        <!--</div>-->
        <div class="col-md-4 col-double">
          <div class="col-left-child">
            <div class="card mb-3 up-card">
              <div class="card-header">Upload CSV File</div>
              <div class="card-body">
                <form id="upload-form" enctype="multipart/form-data">
                  <div class="mb-4">
                    <!--<label for="id_file" class="form-label">Select CSV File</label>-->
                    <input
                      type="file"
                      name="file"
                      id="id_file"
                      class="form-control"
                      accept=".csv"
                    />
                    <div id="file-error" class="text-danger mt-1"></div>
                  </div>
                  <button
                    id="upload-btn-submit"
                    type="submit"
                    class="btn btn-primary"
                    style="display: none"
                  >
                    Upload
                  </button>
                </form>
                <div id="upload-status" class="mt-3">
                  <div class="alert alert-success hidden"></div>
                </div>
                <div id="loader" class="loader hidden"></div>
              </div>
            </div>
            <div id="overview-pane" class="card">
              <div class="card-header">Overview Pane</div>
              <div class="card-body overview-body">
                <div id="overview-text" class="overview-chat"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Chat Section -->
        <div class="col-md-8">
          <div class="card">
            <div class="card-header">Interact with Your Data</div>
            <div class="card-body">
              <div id="chat-container" class="chat-container"></div>
              <div class="input-group">
                <input
                  type="text"
                  id="query-input"
                  class="form-control"
                  placeholder="Ask something about your dataset..."
                  disabled
                />
                <button id="send-query" class="btn btn-primary" disabled>
                  Send
                </button>
              </div>
              <div class="mt-2">
                <span class="badge cursor me-1">overview</span>
                <span class="badge cursor me-1">describe</span>
                <span class="badge cursor me-1">filter:column>value</span>
                <span class="badge cursor me-1">groupby:column,agg</span>
                <span class="badge cursor me-1">sort:column,desc</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-12">
          <div id="data-section" class="card hidden">
            <div class="card-header">Data Preview</div>
            <div class="card-body">
              <ul class="nav nav-tabs" id="dataTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link active"
                    id="analysis-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#analysis"
                    type="button"
                    role="tab"
                  >
                    Analysis
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="pairs-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#pairs"
                    type="button"
                    role="tab"
                  >
                    Pair Testing
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="columns-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#columns"
                    type="button"
                    role="tab"
                  >
                    Column Management
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="preview-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#preview"
                    type="button"
                    role="tab"
                  >
                    Sample
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="stats-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#stats"
                    type="button"
                    role="tab"
                  >
                    Statistics
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="query-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#query-results"
                    type="button"
                    role="tab"
                  >
                    Query Results
                  </button>
                </li>
              </ul>
              <div class="tab-content p-3" id="dataTabsContent">
                <div class="tab-pane fade" id="preview" role="tabpanel">
                  <div id="preview-content"></div>
                  <!-- Preview Tab -->
                  <div
                    class="tab-pane fade show active"
                    id="preview"
                    role="tabpanel"
                  >
                    <div class="text-end mb-3">
                      <a
                        id="download-csv-btn"
                        href="#"
                        class="btn btn-success"
                        style="display: none"
                      >
                        <i class="bi bi-download"></i> Download Modified CSV
                      </a>
                    </div>
                    <div id="preview-content"></div>
                  </div>
                </div>
                <div class="tab-pane fade" id="stats" role="tabpanel">
                  <div id="stats-content"></div>
                </div>
                <div class="tab-pane fade" id="query-results" role="tabpanel">
                  <div id="query-results-content"></div>
                </div>

                <div
                  class="tab-pane fade show active"
                  id="analysis"
                  role="tabpanel"
                >
                  <div class="row">
                    <div class="col-md-4">
                      <div class="card mb-3">
                        <div class="card-header">Variable Selection</div>
                        <div class="card-body">
                          <form id="analysis-form">
                            <div class="mb-3">
                              <!--<label class="form-label">Predictors (Independent Variables)</label>-->
                              <label class="form-label">Predictors</label>
                              <select
                                id="predictors-select"
                                class="form-select"
                                multiple
                              >
                                <!-- Options will be populated dynamically -->
                              </select>
                              <!--<div class="form-text">Hold Ctrl/Cmd to select multiple columns</div>-->
                            </div>

                            <div class="mb-3">
                              <label class="form-label">Response</label>
                              <select id="response-select" class="form-select">
                                <option value="">None (Optional)</option>
                              </select>
                            </div>

                            <hr />

                            <div class="mb-3">
                              <label class="form-label">Analysis Options</label>
                              <div class="d-grid gap-2">
                                <button
                                  type="button"
                                  class="btn btn-outline-primary analysis-btn"
                                  data-type="summary"
                                >
                                  Data Summary
                                </button>
                                <button
                                  type="button"
                                  class="btn btn-outline-primary analysis-btn"
                                  data-type="correlation"
                                >
                                  Correlation Analysis
                                </button>
                                <button
                                  type="button"
                                  class="btn btn-outline-primary analysis-btn"
                                  data-type="pca"
                                >
                                  Principal Component Analysis
                                </button>
                                <button
                                  type="button"
                                  class="btn btn-outline-primary analysis-btn"
                                  data-type="regression"
                                >
                                  Linear Regression
                                </button>
                                <button
                                  type="button"
                                  class="btn btn-outline-primary analysis-btn"
                                  data-type="clustering"
                                >
                                  K-Means Clustering
                                </button>
                                <button
                                  type="button"
                                  class="btn btn-outline-danger analysis-btn mt-4"
                                  data-type="decisiontrees"
                                >
                                  Decision Trees
                                </button>
                              </div>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-8">
                      <div id="analysis-result-container">
                        <div class="card">
                          <div class="card-header">Analysis Results</div>
                          <div class="card-body text-center py-5">
                            <p class="text-muted">
                              Select variables and an analysis method to see
                              results
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Pairs Tab -->
                <div class="tab-pane fade" id="pairs" role="tabpanel">
                  <div class="row">
                    <div class="col-md-4">
                      <div class="card">
                        <div class="card-header">Actions</div>
                        <div class="card-body">
                          <div class="mb-3">
                            <label class="form-label">Response</label>
                            <select
                              id="pair-response-select"
                              class="form-select"
                            >
                              <option value="">None (Optional)</option>
                            </select>
                          </div>
                          <hr />
                          <div class="d-grid gap-2">
                            <button
                              id="run-pair-test-btn"
                              class="btn btn-primary"
                            >
                              Run Pair Test
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div id="pairs-content" class="col-md-8"></div>
                  </div>
                </div>

                <!-- Column Management Tab -->
                <div class="tab-pane fade" id="columns" role="tabpanel">
                  <div class="row">
                    <div class="col-md-8">
                      <div
                        id="column-list"
                        class="column-list list-group mb-3"
                      ></div>
                    </div>
                    <div class="col-md-4">
                      <div class="card">
                        <div class="card-header">Column Actions</div>
                        <div class="card-body">
                          <div class="d-grid gap-2">
                            <button id="add-column-btn" class="btn btn-primary">
                              Add New Column
                            </button>
                            <!--<button id="edit-column-btn" class="btn btn-secondary" disabled > Edit Selected Column </button>-->
                            <button
                              id="delete-column-btn"
                              class="btn btn-danger"
                              disabled
                            >
                              Delete Selected Column
                            </button>
                          </div>
                          <div class="mt-4">
                            <h6>Formula Examples:</h6>
                            <ul class="small">
                              <li><code>A + B</code> - Add columns</li>
                              <!--<li> <code>=A * 100</code> - Excel-style formulas </li>-->
                              <li><code>A > 50</code> - Boolean conditions</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Modal for Adding/Editing Columns -->
                  <div
                    class="modal fade"
                    id="columnModal"
                    tabindex="-1"
                    aria-hidden="true"
                  >
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="columnModalTitle">
                            Add New Column
                          </h5>
                          <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                          ></button>
                        </div>
                        <div class="modal-body">
                          <form id="column-form">
                            <div class="mb-3">
                              <label for="column-name" class="form-label"
                                >Column Name</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="column-name"
                                required
                              />
                            </div>
                            <div class="mb-3">
                              <label for="column-formula" class="form-label"
                                >Formula</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="column-formula"
                                placeholder="Example: A + B or =A+B"
                                required
                              />
                              <!--<div class="form-text">-->
                              <!--Use column names in your formula. Examples:<br />-->
                              <!--- Simple arithmetic:-->
                              <!--<code>Price * Quantity</code><br />-->
                              <!--- With Excel-style formulas:-->
                              <!--<code>=Price*Quantity</code><br />-->
                              <!--- Conditions: <code>Price > 100</code>-->
                              <!--</div>-->
                            </div>
                            <input type="hidden" id="edit-mode" value="add" />
                            <input
                              type="hidden"
                              id="original-column-name"
                              value=""
                            />
                          </form>
                        </div>
                        <div class="modal-footer">
                          <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                          >
                            Cancel
                          </button>
                          <button
                            type="button"
                            class="btn btn-primary"
                            id="save-column"
                          >
                            Save Column
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'fileprocessor/js/index.js' %}"></script>
  </body>
</html>
